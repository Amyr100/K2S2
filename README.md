Запуск:
```
npm install
npm start
# открыть http://localhost:3000
```
Дефолтные аккаунты: alice/alice, bob/bob, carol/carol

...
Ниже — подробный разбор по каждому требованию, что именно реализовано, где это в коде, как работает на фронте/бэке, и что можно улучшить.

Web-страница и раздача статики

Сервер раздаёт содержимое папки public/ как статические файлы (express.static) и в самом конце имеет catch-all-маршрут, который отдаёт public/index.html для любых остальных GET-запросов — это позволяет SPA корректно работать с роутингом. Важно, что catch-all стоит последним, чтобы не перехватывать API-запросы.

Регистрация / вход пользователя

Бэкенд: POST /api/register и POST /api/login. Пароли хэшируются через bcryptjs, а сессии хранятся как токены (UUID) в Map, привязанные к userId. Выход — POST /api/logout (удаляет токен из Map).

Фронтенд: функции doRegister() и doLogin() отправляют JSON на соответствующие эндпоинты, при успехе вызывают setAuth() (сохраняет токен и user в localStorage) и переключают вкладку.

Улучшения: добавить лимиты/валидацию логина, защиту от брутфорса, капчу (при необходимости).

Написание своего поста

Бэкенд: POST /api/posts под requireAuth. Поля: title, content, tags[], visibility ('public'|'request'). Посту проставляются authorId/author, метки времени, и он кладётся в начало массива.

Фронтенд: во вкладке «Мои» (selectTab('mine')) вешается обработчик на форму #form-create: собирает значения, отправляет на /api/posts, очищает форму и перерисовывает списки.

Улучшения: валидация длины, предпросмотр, автосохранение черновика.

Подписка на пользователей

Бэкенд: POST /api/subscribe / POST /api/unsubscribe изменяют массив subscriptions у текущего пользователя и возвращают его же в ответе.

Фронтенд: toggleSubscribe(targetId) дергает нужный эндпоинт, обновляет STATE.user.subscriptions и localStorage, а затем перерисовывает активную секцию (например, «Публичные», «Лента», «Подписки»).

Улучшения: защита от самоподписки (в UI уже не показывается кнопка на себе), подтверждение перед отпиской.

Лента на основе подписок

Бэкенд: GET /api/posts/feed возвращает все посты авторов, на которых вы подписаны, плюс ваши собственные. Учёт доступа: публичные посты всегда видны; «по запросу» — только если вы автор или попали в allowedUsers.

Фронтенд: loadFeed() тянет /api/posts/feed и рендерит карточки через общий renderPosts(...). Есть вспомогательная loadSubscriptions() для кнопки «Подписки/Лента».

Улучшения: пагинация, сортировка по дате/популярности, индикатор «новое с прошлого визита».

Просмотр публичных постов (гостевой режим)

Бэкенд: GET /api/posts/public?userId=... возвращает все посты, но для закрытых (если запрашивающий не автор и не в allowedUsers) — отдаёт «заглушку» с замочком и пометкой «по запросу». Это позволяет показать общий список, не раскрывая содержимое закрытых постов.

Фронтенд: loadPublic() вызывает этот эндпоинт и рендерит через renderPosts(), где на закрытых карточках автоматически появляется кнопка «Запросить доступ» (условие по visibility==='request' и отсутствию доступа).

Улучшения: добавить пагинацию, skeleton-загрузку.

Скрытые посты «только по запросу»

Модель: у поста visibility: 'request' и список allowedUsers.

Доступ: POST /api/posts/:id/request-access создаёт заявку, GET /api/requests видит автор, далее .../approve добавляет просителя в allowedUsers, .../reject — отклоняет.

Фронтенд: кнопка «Запросить доступ» появляется только когда вы не автор и ещё не в допущенных; раздел «Запросы» позволяет автору подтвердить/отклонить.

Улучшения: уведомления в UI (тосты), счётчик непросмотренных запросов.

Редактирование / удаление поста

Бэкенд: PUT /api/posts/:id и DELETE /api/posts/:id разрешены только автору (проверка authorId). Обновляется updatedAt.

Фронтенд: startEdit(postId) (через prompt'ы) и deletePost(postId) (confirm). После изменений секция перерисовывается.

Улучшения: заменить prompt/confirm на модальные формы, валидацию, контроль изменения тегов.

Теги: добавление и сортировка/фильтрация

На создании/редактировании теги принимаются как массив или через запятую и нормализуются (split(','), трим, фильтр пустых).

Поиск по тегам: GET /api/posts/search?tag=...&userId=... — фильтрует только те посты, которые вы имеете право видеть, и ищет точное совпадение по тегу в нижнем регистре.

Фронтенд: searchByTag() отправляет запрос и перерисовывает публичный список; сами теги рисуются чипами на карточке.

Замечание: реализована фильтрация по тегу (точное совпадение), а не «сортировка»; если нужна именно сортировка — можно добавить опцию sort=tag или группировку в ответе.

Комментарии

Бэкенд:

GET /api/posts/:id/comments — отдаёт список, но только если запросивший имеет право читать пост (для закрытых: проверяется токен и доступ).

POST /api/posts/:id/comments — только авторизованным и только если у них есть право читать пост; сохраняет username, обрезает текст до 1000 символов.
Проверка доступа инкапсулирована в canReadPost(...).

Фронтенд: addComment(postId) отправляет текст, loadComments(postId) подгружает и отображает под карточкой; вывод безопасно экранируется (escapeHtml).

Улучшения: индикатор отправки, удаление своих комментариев, пагинация/свёртка длинных цепочек.
